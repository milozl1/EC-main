<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Note Extractor - PDF to Excel</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- SheetJS for Excel generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- JSZip for ZIP creation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- FileSaver for downloads -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        /* Small back button to return to the menu */
        .back-btn {
            display: inline-block;
            margin-bottom: 12px;
            color: #0b5fff;
            text-decoration: none;
            font-weight: 600;
            border-radius: 6px;
            padding: 6px 10px;
            background: rgba(11,95,255,0.06);
            border: 1px solid rgba(11,95,255,0.08);
        }
        .back-btn:hover { background: rgba(11,95,255,0.10); }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <a href="menu.html" class="back-btn" aria-label="Back to Menu">‚Üê Back to Menu</a>
            <h1>üìÑ Delivery Note Extractor</h1>
            <p class="subtitle">Upload PDF files to extract Delivery Notes and generate Excel files</p>
            <p class="version-badge">v7.2 Improved Auto-Fix</p>
        </header>

        <!-- Library Loading Status -->
        <div id="libraryStatus" class="library-status" style="display: none;">
            <div class="library-error">
                <span>‚ö†Ô∏è Error loading libraries. Please check your internet connection.</span>
            </div>
        </div>

        <!-- Upload Section -->
        <section class="upload-section">
            <div class="drop-zone" id="dropZone">
                <div class="drop-zone-content">
                    <span class="drop-icon">üìÅ</span>
                    <p class="drop-text">Drag PDF files here or</p>
                    <button type="button" class="upload-btn" id="selectFilesBtn">
                        Select Files
                    </button>
                    <p class="drop-hint">Accepts .pdf files (max 500 files)</p>
                </div>
            </div>
            <input type="file" id="fileInput" multiple accept=".pdf,application/pdf" style="display: none;">
        </section>

        <!-- File List Section -->
        <section class="files-section" id="filesSection" style="display: none;">
            <div class="section-header">
                <h2>üìã Uploaded Files (<span id="fileCount">0</span>)</h2>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="üîç Search files..." class="search-input">
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn btn-primary" id="processAllBtn" disabled>
                        ‚öôÔ∏è Process All
                    </button>
                    <button type="button" class="btn btn-success" id="downloadAllBtn" disabled>
                        üì• Download All (ZIP)
                    </button>
                    <button type="button" class="btn btn-info" id="exportReportBtn">
                        üìä Export Report
                    </button>
                    <button type="button" class="btn btn-danger" id="clearAllBtn">
                        üóëÔ∏è Clear All
                    </button>
                </div>
            </div>

            <!-- Global Progress -->
            <div class="global-progress" id="globalProgress" style="display: none;">
                <div class="progress-info">
                    <span id="progressText">Processing: 0 / 0</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- File List Table -->
            <div class="table-container">
                <table class="files-table">
                    <thead>
                        <tr>
                            <th data-sort="name" class="sortable" title="Click to sort by file name">File Name ‚Üï</th>
                            <th data-sort="size" class="sortable" title="Click to sort by file size">Size ‚Üï</th>
                            <th data-sort="status" class="sortable" title="Click to sort by status">Status ‚Üï</th>
                            <th class="col-accepted" title="Valid 8-digit delivery notes">Accepted (8d)</th>
                            <th class="col-excluded" title="9-10 digit numbers (too long)">Excluded (9-10d)</th>
                            <th class="col-invalid" title="Invalid entries (letters, special chars, wrong length)">Invalid</th>
                            <th class="col-duplicate" title="Duplicate entries found">Duplicates</th>
                            <th class="col-corrected" title="7-digit numbers auto-corrected to 8 digits">Auto-Fixes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="fileTableBody">
                    </tbody>
                </table>
            </div>

            <!-- Validation Rules Info -->
            <div class="validation-info">
                <h4>üìã Validation Rules</h4>
                <ul>
                    <li><span class="rule-badge accepted">‚úÖ Accepted</span> Exactly 8 digits ‚Üí Exported to Excel</li>
                    <li><span class="rule-badge excluded">‚è≠Ô∏è Excluded</span> 9-10 digits ‚Üí Too long, skipped</li>
                    <li><span class="rule-badge invalid">‚ùå Invalid</span> &lt;7 digits, &gt;10 digits, letters, or special characters</li>
                    <li><span class="rule-badge corrected">üîß Auto-Fix</span> 7 digits ‚Üí Add leading digit based on pattern</li>
                </ul>
            </div>
        </section>

        <!-- Dashboard Summary -->
        <section class="dashboard-section" id="dashboardSection" style="display: none;">
            <h2>üìä Dashboard Summary <small>(Click cards to view details)</small></h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-icon">üìÑ</span>
                    <div class="stat-info">
                        <span class="stat-value" id="totalFiles">0</span>
                        <span class="stat-label">Total Files</span>
                    </div>
                </div>
                <div class="stat-card success clickable" data-type="accepted" title="Click to view all accepted delivery notes">
                    <span class="stat-icon">‚úÖ</span>
                    <div class="stat-info">
                        <span class="stat-value" id="totalAccepted">0</span>
                        <span class="stat-label">Accepted (8 digits)</span>
                    </div>
                </div>
                <div class="stat-card warning clickable" data-type="excluded" title="Click to view all excluded entries">
                    <span class="stat-icon">‚è≠Ô∏è</span>
                    <div class="stat-info">
                        <span class="stat-value" id="totalExcluded">0</span>
                        <span class="stat-label">Excluded (9-10 digits)</span>
                    </div>
                </div>
                <div class="stat-card danger clickable" data-type="invalid" title="Click to view all invalid entries">
                    <span class="stat-icon">‚ùå</span>
                    <div class="stat-info">
                        <span class="stat-value" id="totalInvalid">0</span>
                        <span class="stat-label">Invalid</span>
                    </div>
                </div>
                <div class="stat-card info clickable" data-type="duplicates" title="Click to view all duplicate entries">
                    <span class="stat-icon">üîÑ</span>
                    <div class="stat-info">
                        <span class="stat-value" id="totalDuplicates">0</span>
                        <span class="stat-label">Duplicates</span>
                    </div>
                </div>
                <div class="stat-card auto-correct clickable" data-type="autocorrections" title="Click to view all auto-corrections">
                    <span class="stat-icon">üîß</span>
                    <div class="stat-info">
                        <span class="stat-value" id="totalAutoCorrections">0</span>
                        <span class="stat-label">Auto-Corrections</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Errors Section -->
        <section class="errors-section" id="errorsSection" style="display: none;">
            <h2>‚ö†Ô∏è Errors & Auto-Corrections Report</h2>
            <div id="errorsContainer"></div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Delivery Note Extractor v7.2 </p>
            <p class="footer-hint">Created by Zlatan Milosevic, Jan 2026, Forvia Hella</p>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>
